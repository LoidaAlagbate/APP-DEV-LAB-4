<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Library Information System</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
  background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);
  color:#1e293b;
  padding:24px;
  min-height:100vh;
}
.container{
  max-width:1200px;margin:0 auto;background:white;
  border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.08);overflow:hidden;
}
header{
  background:linear-gradient(135deg,#1e3a8a 0%,#3b82f6 100%);
  padding:32px 40px;color:white;border-bottom:4px solid #1e40af;text-align:center;
}
h1{font-size:2rem;font-weight:700;letter-spacing:-0.5px;margin-bottom:8px;}
.subtitle{font-size:0.95rem;opacity:0.9;font-weight:400;}
.content{padding:32px 40px;}
.section{margin-bottom:32px;}
.section-title{
  font-size:1.1rem;font-weight:600;color:#1e3a8a;margin-bottom:16px;
  padding-bottom:8px;border-bottom:2px solid #e2e8f0;
}
form{display:grid;gap:12px;margin-bottom:24px;}
form#bookForm{grid-template-columns:1fr 1fr 1fr auto;}
form#borrowerForm{grid-template-columns:1fr 1fr auto;}
input,select{
  padding:12px 16px;border:1px solid #cbd5e1;border-radius:6px;
  font-size:0.95rem;transition:all 0.2s;background:white;
}
input:focus,select:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,0.1);}
button{
  padding:12px 20px;border-radius:6px;border:none;font-size:0.9rem;
  font-weight:600;cursor:pointer;transition:all 0.2s;font-family:inherit;
}
button.primary{background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);color:white;box-shadow:0 2px 8px rgba(59,130,246,0.3);}
button.primary:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(59,130,246,0.4);}
button.secondary{background:white;color:#475569;border:1px solid #cbd5e1;}
button.secondary:hover{background:#f8fafc;border-color:#94a3b8;}
button.danger{background:#ef4444;color:white;}
button.danger:hover{background:#dc2626;}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px;padding:20px;background:#f8fafc;border-radius:8px;border:1px solid #e2e8f0;align-items:center;}
.dropdown{position:relative;display:inline-block;}
.dropdown-menu{
  display:none;position:absolute;top:110%;left:0;background:white;
  border:1px solid #cbd5e1;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,0.08);
  z-index:10;
}
.dropdown-menu button{
  display:block;width:100%;text-align:left;background:white;color:#1e293b;
  padding:8px 12px;border:none;border-bottom:1px solid #e2e8f0;
}
.dropdown-menu button:hover{background:#f1f5f9;}
#summary{
  background:linear-gradient(135deg,#dbeafe 0%,#bfdbfe 100%);
  padding:16px 24px;border-radius:8px;border-left:4px solid #3b82f6;
  margin-top:24px;font-weight:600;color:#1e3a8a;display:flex;justify-content:space-around;text-align:center;
}
.stat{display:flex;flex-direction:column;gap:4px;}
.stat-label{font-size:0.85rem;font-weight:500;opacity:0.8;}
.stat-value{font-size:1.5rem;font-weight:700;}
table{width:100%;border-collapse:collapse;border:1px solid #e2e8f0;border-radius:8px;overflow:hidden;}
th,td{padding:12px 16px;border-bottom:1px solid #f1f5f9;font-size:0.95rem;text-align:left;}
th{background:linear-gradient(135deg,#f1f5f9 0%,#e2e8f0 100%);font-weight:700;color:#1e3a8a;}
tr:hover{background:#f8fafc;}
.status{padding:4px 10px;border-radius:12px;font-size:0.85rem;font-weight:600;}
.available{background:#d1fae5;color:#065f46;}
.borrowed{background:#fee2e2;color:#991b1b;}
.overdue{color:red;font-weight:700;}
.actions{display:flex;gap:6px;}
.actions button{padding:6px 12px;font-size:0.85rem;}
.empty-state{text-align:center;padding:40px 20px;color:#94a3b8;}
</style>
</head>
<body>
<div class="container">
<header>
  <h2>Library Information System</h2>
  <div class="subtitle">Books and Borrower's Information System</div>
</header>
<div class="content">
  <div class="section">
    <div class="section-title">Register Borrower</div>
    <form id="borrowerForm">
      <input type="text" id="borrowerName" placeholder="Borrower Name" required>
      <select id="borrowerId">
        <option value="">Select ID (1-100)</option>
      </select>
      <button type="submit" class="primary">Add Borrower</button>
    </form>
  </div>

  <div class="section">
    <div class="section-title">Add New Book</div>
    <form id="bookForm">
      <input type="text" id="title" placeholder="Book Title" required>
      <input type="text" id="author" placeholder="Author Name" required>
      <select id="year" required></select>
      <button type="submit" class="primary">Add Book</button>
    </form>
  </div>

  <div class="section">
    <div class="section-title">Manage & Filter</div>
    <div class="controls">
      <button id="filterBtn" class="secondary">Filter (Books published after 2015)</button>
      <div class="dropdown">
        <button id="sortTitleBtn" class="secondary">Sort by Title</button>
        <div class="dropdown-menu" id="titleDropdown">
          <button data-type="title" data-order="asc">Ascending</button>
          <button data-type="title" data-order="desc">Descending</button>
        </div>
      </div>
      <div class="dropdown">
        <button id="sortYearBtn" class="secondary">Sort by Year</button>
        <div class="dropdown-menu" id="yearDropdown">
          <button data-type="year" data-order="asc">Ascending</button>
          <button data-type="year" data-order="desc">Descending</button>
        </div>
      </div>
      <button id="resetBtn" class="secondary">Reset</button>
      <button id="deleteAllBtn" class="danger">Delete All</button>
      <input type="text" id="search" placeholder="Search books or authors..." style="margin-left:auto;">
    </div>
  </div>

  <div id="list"></div>
  <div id="borrowerTable"></div>
  <div id="summary"></div>
</div>
</div>

<script>
// Main data arrays for books and borrowers
let books=[];                 // stores book objects
let borrowers=[];                  // stores borrower objects

// DOM references used throughout the script
const listEl=document.getElementById('list');
const borrowerTable=document.getElementById('borrowerTable');
const summaryEl=document.getElementById('summary');
const idSelect=document.getElementById('borrowerId');

// populate borrower ID select (1..100) and year select (1400..2025)
for(let i=1;i<=100;i++){let opt=document.createElement('option');opt.value=i;opt.textContent=i;idSelect.appendChild(opt);}
const yearSel=document.getElementById('year');
for(let y=1400;y<=2025;y++){let o=document.createElement('option');o.value=y;o.textContent=y;yearSel.appendChild(o);}

// render() builds the book list UI and updates the summary
function render(data=books){
  console.log('render() called with', data.length, 'items'); // log render calls
  listEl.innerHTML="";
  if(data.length===0){
    listEl.innerHTML='<div class="empty-state">No books available</div>';
    updateSummary();
    return;
  }
  const table=document.createElement('table');
  const header=document.createElement('tr');
  header.innerHTML='<th>Title</th><th>Author</th><th>Year</th><th>Status</th><th>Borrower</th><th>Borrow Date</th><th>Due Date</th><th>Actions</th>';
  table.appendChild(header);

  // iterate books and create rows
  data.forEach(b=>{
    const row=document.createElement('tr');
    let status=b.isOverdue?'Overdue':b.isAvailable?'Available':'Borrowed';
    row.innerHTML=`<td>${b.title}</td><td>${b.author}</td><td>${b.year}</td>
    <td class="${status.toLowerCase()}">${status}</td>
    <td>${b.borrower||'-'}</td>
    <td>${b.borrowDate||'-'}</td>
    <td>${b.dueDate||'-'}</td>
    <td class="actions">
      <button class="secondary" onclick="handleBorrow('${b.title}','${b.author}')">Borrow</button>
      <button class="secondary" onclick="handleReturn('${b.title}','${b.author}')">Return</button>
      <button class="secondary" onclick="markOverdue('${b.title}','${b.author}')">Mark Overdue</button>
      <button class="danger" onclick="handleDelete('${b.title}','${b.author}')">Delete</button>
    </td>`;
    table.appendChild(row);
  });
  listEl.appendChild(table);
  updateSummary();
}

// updateSummary() recalculates totals and updates the bottom summary block
function updateSummary(){
  const total=books.length;
  const available=books.filter(b=>b.isAvailable).length;
  const borrowed=books.filter(b=>!b.isAvailable&&!b.isOverdue).length;
  const overdue=books.filter(b=>b.isOverdue).length;
  summaryEl.innerHTML=`
  <div class="stat"><div class="stat-label">Total Books</div><div class="stat-value">${total}</div></div>
  <div class="stat"><div class="stat-label">Available</div><div class="stat-value">${available}</div></div>
  <div class="stat"><div class="stat-label">Borrowed</div><div class="stat-value">${borrowed}</div></div>
  <div class="stat"><div class="stat-label">Overdue</div><div class="stat-value">${overdue}</div></div>`;

  // console log the summary for grading / verification
  console.log('Summary updated', { total, available, borrowed, overdue });

  // render borrower table below summary area
  let btable='<div class="section-title">Borrowers</div>';
  if(borrowers.length===0){ borrowerTable.innerHTML='<div class="empty-state">No borrowers registered</div>'; return; }
  btable+='<table><tr><th>Name</th><th>ID</th><th>Borrowed Book/s</th><th>Actions</th></tr>';
  borrowers.forEach(br=>{
    // join borrowed titles for display
    btable+=`<tr><td>${br.name}</td><td>${br.id}</td><td>${br.borrowed.join(', ')||'-'}</td>
    <td><button class="danger" onclick="deleteBorrower('${br.id}')">Delete</button></td></tr>`;
  });
  btable+='</table>';
  borrowerTable.innerHTML=btable;
  // log borrowers array state for verification
  console.log('Borrowers array:', JSON.parse(JSON.stringify(borrowers)));
}

// Add borrower handler - validates and adds to array
document.getElementById('borrowerForm').addEventListener('submit',e=>{
  e.preventDefault();
  const name=document.getElementById('borrowerName').value.trim();
  const id=document.getElementById('borrowerId').value;
  if(!name||!id){alert('Fill borrower name and ID');return;}
  if(borrowers.some(b=>b.id===id)){alert('ID already assigned');return;}
  const newBr={name,id,borrowed:[]};
  borrowers.push(newBr);
  // console log: borrower added + current borrowers array
  console.log('Borrower added:', JSON.parse(JSON.stringify(newBr)));
  console.log('Borrowers now:', JSON.parse(JSON.stringify(borrowers)));
  document.getElementById('borrowerName').value="";
  document.getElementById('borrowerId').value="";
  render();
});

// Add book handler - validates and adds to array (duplicates allowed per spec)
document.getElementById('bookForm').addEventListener('submit',e=>{
  e.preventDefault();
  const title=document.getElementById('title').value.trim();
  const author=document.getElementById('author').value.trim();
  const year=parseInt(document.getElementById('year').value);
  if(!title||!author||!year){alert('Fill all fields');return;}
  const newBook={title,author,year,isAvailable:true,isOverdue:false,borrower:null,borrowDate:null,dueDate:null};
  books.push(newBook);
  // console log: book added + current books array length and sample
  console.log('Book added:', JSON.parse(JSON.stringify(newBook)));
  console.log('Books count:', books.length);
  e.target.reset();
  render();
});

// Borrow flow: show modal with dropdown (no typing) and confirm selection
function handleBorrow(title,author){
  const book=books.find(b=>b.title===title&&b.author===author);
  if(!book||!book.isAvailable){alert('Not available');return;}
  if(borrowers.length===0){alert('No borrowers registered');return;}
  // create small modal with select dropdown of borrower names
  const dropdown=document.createElement('select');
  dropdown.innerHTML='<option value="">Select Borrower</option>'+borrowers.map(b=>`<option value="${b.name}">${b.name} (${b.id})</option>`).join('');
  const confirmBtn=document.createElement('button'); confirmBtn.textContent='Confirm'; confirmBtn.className='primary';
  const modal=document.createElement('div');
  Object.assign(modal.style,{position:'fixed',top:'0',left:'0',width:'100%',height:'100%',background:'rgba(0,0,0,0.4)',display:'flex',alignItems:'center',justifyContent:'center'});
  const box=document.createElement('div');
  Object.assign(box.style,{background:'white',padding:'20px',borderRadius:'8px',minWidth:'280px'});
  box.innerHTML='<h3>Select Borrower</h3>';
  box.appendChild(dropdown); box.appendChild(confirmBtn); modal.appendChild(box); document.body.appendChild(modal);

  confirmBtn.onclick=()=>{
    const name=dropdown.value;
    if(!name){alert('Select a borrower');return;}
    const borrower=borrowers.find(b=>b.name===name);
    const borrowDate=new Date();
    const dueDate=new Date(borrowDate.getTime()+14*24*60*60*1000);
    // update book object
    book.isAvailable=false; book.borrower=borrower.name;
    book.borrowDate=borrowDate.toLocaleDateString(); book.dueDate=dueDate.toLocaleDateString();
    // update borrower record
    borrower.borrowed.push(book.title);
    // console log: borrow action and resulting objects/arrays
    console.log('Book borrowed:', { book: JSON.parse(JSON.stringify(book)), borrowerId: borrower.id });
    console.log('Books array now:', JSON.parse(JSON.stringify(books)));
    console.log('Borrower record now:', JSON.parse(JSON.stringify(borrower)));
    document.body.removeChild(modal);
    render();
  };
}

// Return a book: clear borrow fields and remove from borrower record
function handleReturn(title,author){
  const book=books.find(b=>b.title===title&&b.author===author);
  if(!book||book.isAvailable){alert('Book not borrowed');return;}
  const borrower=borrowers.find(b=>b.name===book.borrower);
  if(borrower){ borrower.borrowed = borrower.borrowed.filter(t=>t!==title); }
  Object.assign(book,{isAvailable:true,borrower:null,borrowDate:null,dueDate:null,isOverdue:false});
  // console log: book returned + borrower update
  console.log('Book returned:', JSON.parse(JSON.stringify(book)));
  if(borrower) console.log('Borrower after return:', JSON.parse(JSON.stringify(borrower)));
  render();
}

// Mark overdue manually (librarian action)
function markOverdue(title,author){
  const book=books.find(b=>b.title===title&&b.author===author);
  if(book && !book.isAvailable){
    book.isOverdue=true;
    // mark in borrower's record too
    const br = borrowers.find(b=>b.name===book.borrower);
    if(br){ /* mark visually only; record kept in br.borrowed (titles) */ }
    console.log('Book marked overdue:', JSON.parse(JSON.stringify(book)));
    render();
  }
}

// Delete a book (confirm first)
function handleDelete(title,author){
  if(!confirm('Delete this book?')) return;
  books = books.filter(b=>!(b.title===title && b.author===author));
  console.log('Book deleted:', { title, author });
  console.log('Books now:', JSON.parse(JSON.stringify(books)));
  render();
}

// Delete borrower: prevent deletion if they have borrowed books
function deleteBorrower(id){
  const br = borrowers.find(b=>b.id===id);
  if(!br) return;
  if(br.borrowed.length>0){ alert('Cannot delete borrower with borrowed books'); return; }
  if(confirm('Delete this borrower?')){
    borrowers = borrowers.filter(b=>b.id!==id);
    console.log('Borrower deleted:', id);
    console.log('Borrowers now:', JSON.parse(JSON.stringify(borrowers)));
    render();
  }
}

// Controls: filter, reset, delete all, sort toggles (dropdowns)
document.getElementById('filterBtn').addEventListener('click', ()=>{
  const filtered = books.filter(b => b.year > 2015);
  console.log('Filter applied (year>2015):', JSON.parse(JSON.stringify(filtered)));
  render(filtered);
});
document.getElementById('resetBtn').addEventListener('click', ()=>{
  console.log('Reset filters - rendering full list');
  render();
});
document.getElementById('deleteAllBtn').addEventListener('click', ()=>{
  if(!confirm('Delete all books?')) return;
  books = [];
  // also clear borrower borrowed lists
  borrowers.forEach(br => br.borrowed = []);
  console.log('All books deleted; borrowers cleared of borrowed lists');
  render();
});

// sort dropdown toggles
document.getElementById('sortTitleBtn').addEventListener('click', ()=>{ toggleDropdown('titleDropdown'); });
document.getElementById('sortYearBtn').addEventListener('click', ()=>{ toggleDropdown('yearDropdown'); });
function toggleDropdown(id){ const dd = document.getElementById(id); dd.style.display = dd.style.display==='block' ? 'none' : 'block'; }

// sort option handlers - apply sort then hide dropdown and log action
document.querySelectorAll('.dropdown-menu button').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const type = btn.dataset.type, order = btn.dataset.order;
    if(type==='title') books.sort((a,b)=> order==='asc' ? a.title.localeCompare(b.title) : b.title.localeCompare(a.title));
    if(type==='year') books.sort((a,b)=> order==='asc' ? a.year - b.year : b.year - a.year);
    console.log(`Sorted by ${type} (${order})`);
    toggleDropdown(type==='title' ? 'titleDropdown' : 'yearDropdown');
    console.log('Books after sort:', JSON.parse(JSON.stringify(books.map(b=>({ title: b.title, year: b.year })))) );
    render();
  });
});

// Live search (partial keywords) - logs results
document.getElementById('search').addEventListener('input', e=>{
  const key = e.target.value.trim().toLowerCase();
  if(!key){ console.log('Search cleared - rendering all'); render(); return; }
  const results = books.filter(b => b.title.toLowerCase().includes(key) || b.author.toLowerCase().includes(key));
  console.log(`Search for "${key}" returned ${results.length} results`, JSON.parse(JSON.stringify(results)));
  render(results);
});

// initial render
console.log('Initial state - books and borrowers empty arrays');
render();
</script>
</body>
</html>
